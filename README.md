# 茂亨Odoo管理脚本

专为外贸企业定制的Odoo管理系统部署工具，基于原生Odoo深度优化外贸业务流程，采用Docker容器化部署。

## ⚠️ 重要说明

### 单实例设计
- **本脚本仅支持单实例部署**，一台服务器只能部署一个茂亨Odoo实例
- 不支持也不需要多实例部署，确保系统稳定性和资源优化

### 数据安全保护
- **所有数据均映射到Docker卷中**，而非直接映射到主机目录
- 这种设计可以**防止用户误操作**和**避免第三方插件冲突**
- **强烈建议用户不要自行安装第三方模块**，可能导致系统不稳定

### 免责声明
⚠️ **重要提醒**：如果用户自行安装第三方模块导致Odoo出现任何问题（包括但不限于系统崩溃、数据丢失、性能下降等），**茂亨科技概不负责**。我们建议所有功能需求通过官方渠道咨询和定制。

## 茂亨Odoo介绍

茂亨Odoo是基于开源Odoo针对外贸企业深度定制的完整管理系统，包含进销存、财务、客户管理等全部企业管理模块和网站功能。本部署脚本专注于企业管理功能的性能优化和安全加固，**推荐用于企业内部管理，不推荐使用网站功能**。

### 🎯 **推荐部署方式**

#### ✅ 推荐部署模式
- **本地部署**：企业内网环境，通过服务器IP访问
- **二级域名部署**：如 `erp.company.com`，专用于企业管理

#### ❌ 不推荐网站功能
**重要说明**：我们通常不推荐使用Odoo的网站功能，原因如下：

1. **服务器位置冲突**：
   - 企业管理系统需要靠近员工（内网或就近部署）
   - 网站需要靠近客户（全球CDN分发）
   - 无法同时满足两种需求的最佳访问速度

2. **功能专业性差异**：
   - Odoo网站功能不如WordPress等专业网站系统
   - 缺乏丰富的主题和插件生态
   - SEO和营销功能相对薄弱

3. **性能和安全考虑**：
   - 企业管理系统需要高安全性配置
   - 网站需要面向公网优化
   - 两者需求存在冲突

#### ✅ 例外情况：可以使用网站功能

**当客户和员工在同一地理区域时**，可以考虑使用Odoo网站功能：

**适用场景**：
- ✅ **国内企业**：客户和员工都在中国国内
- ✅ **区域性企业**：业务范围限定在特定地区
- ✅ **本地服务商**：主要服务本地客户

**中国国内的特殊优势**：
- ✅ **服务器位置统一**：可以部署在国内机房，同时优化员工和客户访问
- ✅ **网络环境一致**：避免跨境网络延迟和稳定性问题
- ✅ **WordPress限制**：由于网络环境限制，WordPress等国外建站工具使用不便
- ✅ **一体化管理**：客户数据和网站内容统一管理，便于维护

**建议方案**：
- **全球业务**：企业管理用茂亨Odoo，网站用WordPress等专业系统
- **国内业务**：可以考虑使用茂亨Odoo的网站功能，实现一体化管理

## 技术特性

- ✅ **智能检测**: 自动检测现有实例（脚本管理/手动部署）
- ✅ **推荐部署**: 本地模式和二级域名模式，专注企业管理
- ✅ **智能域名**: 自动处理域名配置，支持二级域名部署
- ✅ **SSL自动化**: 自动获取和续期Let's Encrypt证书
- ✅ **完整备份**: 数据库、配置文件、环境变量一键备份
- ✅ **跨服务器迁移**: 备份文件可直接在新服务器恢复
- ✅ **实例迁移**: 手动部署实例迁移到脚本管理
- ✅ **性能优化**: 专注企业管理功能，根据服务器配置自动优化
- ✅ **安全加固**: 防火墙配置、安全头部、访问控制
- ✅ **健康监控**: 容器健康检查、系统状态监控
- ✅ **数据保护**: Docker卷映射，防止误操作和插件冲突

## 快速开始

### 0. 系统要求检查

**支持的操作系统**：
- ✅ **仅支持Ubuntu系统**（推荐24.04 LTS，支持22.04/20.04 LTS）

**检查系统版本**：
```bash
lsb_release -a
# 确认显示 Distributor ID: Ubuntu
```

**如果不是Ubuntu系统**：
```bash
# 请重新安装Ubuntu系统或使用Ubuntu虚拟机
# 推荐下载: Ubuntu 24.04 LTS（首选）或 22.04 LTS
```

**如需升级Ubuntu版本**：
```bash
# 升级到Ubuntu 24.04 LTS（推荐）
sudo do-release-upgrade -d

# 或者从Ubuntu 22.04升级到24.04
sudo apt update && sudo apt upgrade -y
sudo do-release-upgrade
```

**升级后优化**：
```bash
# 重新运行脚本以应用24.04专用优化
sudo ./morhon-odoo.sh
# 选择：管理实例 -> 性能优化
```

### 1. 下载脚本

```bash
wget https://raw.githubusercontent.com/morhon-tech/morhon-odoo/main/morhon-odoo.sh
chmod +x morhon-odoo.sh
```

### 2. 运行脚本

```bash
sudo ./morhon-odoo.sh
```

### 3. 选择部署模式

脚本会自动检测环境并显示相应菜单：
- **无实例**: 全新部署 或 从备份恢复
- **手动实例**: 迁移到脚本管理
- **脚本实例**: 管理现有实例

**推荐部署方式**：
- ✅ **本地部署**：直接回车，通过IP访问（最推荐）
- ✅ **二级域名**：输入如 `erp.company.com`（推荐）
- ⚠️ **主域名**：输入如 `company.com`（不推荐，与网站冲突）

### 4. 实例管理功能

对于已部署的实例，脚本提供完整的管理功能：

- **查看实例状态** - 检查容器运行状态、资源使用情况
- **重启实例** - 安全重启Odoo和数据库服务
- **查看日志** - 实时查看应用和系统日志
- **备份实例** - 完整备份数据库、配置和环境变量
- **修改配置** - 安全修改Odoo和系统配置
- **系统状态检查** - 全面检查系统健康状态

## 部署模式

### ✅ 推荐模式

#### 本地模式（强烈推荐）
- **触发条件**: 域名输入为空
- **访问方式**: `http://服务器IP`
- **适用场景**: 企业内网环境，员工内部使用
- **优势**: 访问速度快，安全性高，维护简单

#### 二级域名模式（推荐）
- **触发条件**: 输入二级域名（如 `erp.company.com`）
- **访问方式**: `https://erp.company.com`
- **适用场景**: 企业专用管理系统，远程办公
- **优势**: 专业性强，便于管理，安全可控

### ⚠️ 不推荐模式

#### 主域名模式（不推荐用于网站）
- **说明**: 虽然脚本支持主域名部署，但不推荐用于网站功能
- **原因**: 
  - 服务器位置无法同时优化企业管理和网站访问
  - Odoo网站功能不如专业网站系统
  - 企业管理和网站的安全需求存在冲突

### 智能域名处理逻辑

脚本会根据您输入的域名自动配置相应的访问方式和跳转规则：

| 输入域名 | 主访问域名 | 跳转规则 | SSL证书 | 推荐用途 |
|---------|-----------|---------|---------|----------|
| `company.com` | `company.com` | `www.company.com` → `company.com` | company.com | ❌ 不推荐（网站冲突） |
| `www.company.com` | `www.company.com` | `company.com` → `www.company.com` | company.com | ❌ 不推荐（网站冲突） |
| `erp.company.com` | `erp.company.com` | 无跳转 | erp.company.com | ✅ 推荐（企业管理专用） |
| `manage.company.com` | `manage.company.com` | 无跳转 | manage.company.com | ✅ 推荐（企业管理专用） |

**推荐的二级域名示例**：
- `erp.company.com` - 企业资源规划
- `manage.company.com` - 企业管理系统  
- `admin.company.com` - 管理后台
- `office.company.com` - 办公系统

**智能域名处理特性**：
- ✅ **自动检测**：无需手动选择，根据输入自动配置
- ✅ **SSL优化**：自动申请合适的证书覆盖范围
- ✅ **二级域名支持**：完美支持子域名部署
- ✅ **企业专用**：二级域名更适合企业内部系统

**配置示例**：
```bash
# 推荐：二级域名部署
输入: erp.company.com
访问: https://erp.company.com ✓ (企业管理专用)

# 推荐：本地部署  
输入: (直接回车)
访问: http://192.168.1.100 ✓ (内网访问)

# 不推荐：主域名部署
输入: company.com
访问: https://company.com ⚠️ (与网站功能冲突)
```

## 系统要求和VPS配置推荐

### 外贸企业用户规模与配置对照表

| 用户数量 | CPU核心 | 内存 | 存储 | 带宽 | 月费用估算 | 适用场景 |
|---------|---------|------|------|------|-----------|----------|
| 5-15人 | 4核心 | 8GB | 80GB SSD | 5Mbps | $40-80 | 小型外贸团队 |
| 15-50人 | 6核心 | 16GB | 160GB SSD | 10Mbps | $80-150 | 中型外贸企业 |
| 50-150人 | 8核心 | 32GB | 320GB SSD | 20Mbps | $150-300 | 大型外贸企业 |
| 150-300人 | 12核心 | 64GB | 500GB SSD | 50Mbps | $300-500 | 集团型外贸企业 |
| 300-500人 | 16核心 | 128GB | 1TB SSD | 100Mbps | $500-800 | 超大型外贸集团 |

### 系统要求（仅支持Ubuntu）

⚠️ **重要说明**：本脚本**仅支持Ubuntu系统**，以确保最佳的稳定性和兼容性。

**支持的Ubuntu版本**：
- ✅ **Ubuntu 24.04 LTS**（🌟 **首选推荐**，长期支持到2029年）
- ✅ **Ubuntu 22.04 LTS**（推荐，长期支持到2027年）
- ✅ **Ubuntu 20.04 LTS**（支持，长期支持到2025年，建议升级）
- ❌ **Ubuntu 18.04 LTS**（不再支持，请升级到24.04 LTS）

**硬件配置要求**：
- **CPU**: 4核心 2.4GHz+ (推荐Intel/AMD x86_64)
- **内存**: 8GB RAM (推荐16GB+)
- **存储**: 80GB可用空间 (推荐NVMe SSD)
- **网络**: 稳定的互联网连接，5Mbps+

### Ubuntu版本特性对比

| 特性 | Ubuntu 20.04 LTS | Ubuntu 22.04 LTS | Ubuntu 24.04 LTS 🌟 |
|------|------------------|------------------|---------------------|
| **内核版本** | Linux 5.4 | Linux 5.15 | Linux 6.8 |
| **支持周期** | 2025年4月 | 2027年4月 | 2029年4月 |
| **Docker性能** | 标准 | 优化 | 最佳 (+20%) |
| **网络性能** | 标准 | 改进 | 最佳 (+25%) |
| **内存效率** | 标准 | 优化 | 最佳 (+30%) |
| **安全特性** | 基础 | 增强 | 最新 |
| **容器支持** | 良好 | 很好 | 最佳 |
| **BBR拥塞控制** | 可选 | 默认 | 优化版 |
| **eBPF支持** | 基础 | 完整 | 增强 |
| **推荐等级** | ⚠️ 基础支持 | ✅ 推荐 | 🌟 **首选** |

**Ubuntu 24.04 LTS独有优势**：
- 🔥 **最新内核6.8**：更好的硬件支持和性能优化
- 🔥 **增强的容器运行时**：Docker和containerd性能提升20%
- 🔥 **优化的网络栈**：BBR v3拥塞控制，网络性能提升25%
- 🔥 **改进的内存管理**：MGLRU算法，内存效率提升30%
- 🔥 **更强的安全性**：最新的安全补丁和防护机制
- 🔥 **更长的支持周期**：支持到2029年，减少升级频率

**为什么只支持Ubuntu**：
- ✅ **简化维护**：专注单一系统，减少兼容性问题
- ✅ **最佳支持**：Ubuntu在Docker和容器技术方面支持最完善
- ✅ **稳定可靠**：LTS版本提供长期稳定支持
- ✅ **社区活跃**：丰富的文档和社区资源
- ✅ **企业首选**：大多数企业和云服务商的首选Linux发行版

### 推荐VPS提供商配置

**操作系统选择**：
- ✅ **Ubuntu 24.04 LTS**（🌟 **首选推荐**，长期支持到2029年）
- ✅ **Ubuntu 22.04 LTS**（推荐，长期支持到2027年）  
- ✅ **Ubuntu 20.04 LTS**（支持，长期支持到2025年）

#### 入门型配置 (5-15人)
```
操作系统: Ubuntu 24.04 LTS（推荐）
CPU: 4核心 2.4GHz+
内存: 8GB DDR4
存储: 80GB NVMe SSD
带宽: 5Mbps 不限流量
价格: $40-80/月
适用: 小型外贸团队，基础业务流程
```

#### 标准型配置 (15-50人)
```
操作系统: Ubuntu 24.04 LTS（推荐）
CPU: 6核心 2.4GHz+
内存: 16GB DDR4
存储: 160GB NVMe SSD
带宽: 10Mbps 不限流量
价格: $80-150/月
适用: 中型外贸企业，完整业务流程
```

#### 企业型配置 (50-150人)
```
操作系统: Ubuntu 24.04 LTS（推荐）
CPU: 8核心 2.4GHz+
内存: 32GB DDR4
存储: 320GB NVMe SSD
带宽: 20Mbps 不限流量
价格: $150-300/月
适用: 大型外贸企业，复杂业务场景
```

#### 集团型配置 (150人以上)
```
操作系统: Ubuntu 24.04 LTS（推荐）
CPU: 12核心+ 2.4GHz+
内存: 64GB+ DDR4
存储: 500GB+ NVMe SSD
带宽: 50Mbps+ 不限流量
价格: $300-800/月
适用: 集团型企业，多分支机构
```

### 外贸企业性能基准测试

#### Ubuntu 24.04 LTS性能基准（推荐）

| 配置等级 | 并发用户 | 页面响应 | 报表生成 | 数据导入 | 复杂查询 | 内存效率 |
|---------|---------|---------|---------|---------|----------|----------|
| 入门型 | 20人 | <1.5秒 | <4秒 | 1500条/分钟 | <0.8秒 | +15% |
| 标准型 | 60人 | <1秒 | <2.5秒 | 4000条/分钟 | <0.4秒 | +20% |
| 企业型 | 180人 | <0.8秒 | <1.5秒 | 6000条/分钟 | <0.25秒 | +25% |
| 集团型 | 400人+ | <0.6秒 | <1秒 | 12000条/分钟 | <0.15秒 | +30% |

#### 其他Ubuntu版本性能基准

| 配置等级 | 并发用户 | 页面响应 | 报表生成 | 数据导入 | 复杂查询 |
|---------|---------|---------|---------|---------|----------|
| 入门型 | 15人 | <2秒 | <5秒 | 1000条/分钟 | <1秒 |
| 标准型 | 50人 | <1.5秒 | <3秒 | 3000条/分钟 | <0.5秒 |
| 企业型 | 150人 | <1秒 | <2秒 | 5000条/分钟 | <0.3秒 |
| 集团型 | 300人+ | <0.8秒 | <1.5秒 | 10000条/分钟 | <0.2秒 |

**Ubuntu 24.04 LTS性能优势**：
- 🚀 **响应速度提升25%**：优化的内核调度和内存管理
- 🚀 **并发处理能力提升20%**：改进的网络栈和TCP优化
- 🚀 **数据处理速度提升20%**：更高效的I/O子系统
- 🚀 **内存利用率提升30%**：先进的内存压缩和回收机制

### ⚠️ 配置不足的风险

**使用低于推荐配置的VPS可能导致**：
- 系统响应缓慢，影响业务效率
- 多用户并发访问时系统卡顿
- 复杂报表生成超时失败
- 数据导入导出速度极慢
- 系统内存不足导致服务崩溃
- 财务计算和库存更新延迟

**强烈建议**：
- 外贸企业至少使用 **4核8GB** 配置
- 生产环境推荐 **6核16GB** 或更高
- 使用SSD存储提升数据库性能
- 确保足够的带宽支持文件上传下载

### 为什么需要更高配置？

#### 🔄 **多模块并发运行**
- 进销存管理：库存实时更新、采购订单处理
- 财务管理：应收应付计算、成本核算
- 营销管理：客户关系维护、报价生成
- 外贸专业：单证处理、物流跟踪

#### 📊 **数据密集型操作**
- 大量产品SKU管理
- 复杂的财务报表生成
- 多币种汇率实时计算
- 客户订单历史分析

#### 🌐 **多用户并发访问**
- 销售团队同时录入订单
- 财务人员处理应收应付
- 仓库管理员更新库存
- 管理层查看实时报表

#### 💾 **数据存储需求**
- 产品图片和文档存储
- 客户沟通记录保存
- 财务凭证长期归档
- 业务数据备份冗余

## 命令行用法

```bash
# 交互式菜单（推荐）
sudo ./morhon-odoo.sh

# 初始化环境
sudo ./morhon-odoo.sh init

# 备份实例
sudo ./morhon-odoo.sh backup

# 从备份恢复
sudo ./morhon-odoo.sh restore

# 查看状态
sudo ./morhon-odoo.sh status

# 显示帮助
./morhon-odoo.sh help
```

## 跨服务器迁移

### 源服务器备份
```bash
sudo ./morhon-odoo.sh
# 选择：管理实例 -> 备份实例
# 备份文件：/var/backups/morhon-odoo/backup_YYYYMMDD_HHMMSS.tar.gz
```

### 目标服务器恢复
```bash
# 1. 将脚本和备份文件放在同一目录
# 2. 运行脚本
sudo ./morhon-odoo.sh
# 选择：从备份恢复
# 3. 输入域名（支持多种格式）:
#    - example.com (仅主域名)
#    - www.example.com (主域名+www)
#    - sub.example.com (二级域名)
#    - 直接回车 (本地模式)
```

## 技术架构

### 系统架构
```
用户访问 → Nginx反向代理 → Odoo应用容器 → PostgreSQL数据库容器
```

### 目录结构
```
/opt/morhon-odoo/          # 实例根目录
├── docker-compose.yml     # Docker编排文件
├── .env                   # 环境变量配置
├── config/odoo.conf       # Odoo配置文件
├── logs/                  # 应用日志目录
└── backups/               # 本地备份目录

/var/backups/morhon-odoo/  # 备份存储目录
/var/log/morhon-odoo/      # 脚本日志目录
```

### 容器架构
- **morhon-odoo**: Odoo应用容器
- **morhon-odoo-db**: PostgreSQL数据库容器
- **morhon-network**: 独立Docker网络
- **morhon-pg**: 数据库持久化卷（新版本）
- **morhon-odoo**: Odoo文件持久化卷（新版本）

### 卷名说明
**新部署实例**：`morhon-pg`（数据库）、`morhon-odoo`（应用数据）
**旧版本实例**：`odoo-db-data`（数据库）、`odoo-web-data`（应用数据）
**迁移处理**：脚本自动检测并处理卷名差异

## 备份和恢复

### 备份内容
- 数据库完整备份 (database.sql.gz)
- Odoo配置文件 (config/)
- Docker Compose配置 (docker-compose.yml)
- 环境变量 (.env)
- Nginx配置 (nginx-config)
- 备份信息 (backup_info.txt)

### 备份文件管理
```bash
# 查看备份内容
tar -tzf backup_20250107_143022.tar.gz

# 备份文件位置
/var/backups/morhon-odoo/backup_YYYYMMDD_HHMMSS.tar.gz
```

## 常用操作

### 查看日志
```bash
# 脚本日志
tail -f /var/log/morhon-odoo/morhon-odoo.log

# Odoo日志
sudo docker-compose -f /opt/morhon-odoo/docker-compose.yml logs -f odoo

# Nginx日志
tail -f /var/log/nginx/morhon-odoo-error.log
```

### 重启服务
```bash
# 通过脚本重启
sudo ./morhon-odoo.sh
# 选择：管理实例 -> 重启实例

# 手动重启
cd /opt/morhon-odoo && sudo docker-compose restart
sudo systemctl reload nginx
```

### 修改配置
```bash
# 通过脚本修改
sudo ./morhon-odoo.sh
# 选择：管理实例 -> 修改配置

# 手动修改
sudo nano /opt/morhon-odoo/config/odoo.conf
sudo nano /opt/morhon-odoo/.env
cd /opt/morhon-odoo && sudo docker-compose restart
```

## 故障排除

### 常见问题

**1. 备份文件未找到**
```bash
# 确保文件在同一目录
ls -la *.tar.gz *.sh
chmod +x morhon-odoo.sh
```

**2. 容器启动失败**
```bash
sudo docker ps -a
cd /opt/morhon-odoo && sudo docker-compose logs
```

**3. 无法访问网站**
```bash
# 检查端口和服务
sudo netstat -tlnp | grep -E ":(80|443|8069)"
sudo systemctl status nginx
```

**4. SSL证书问题**
```bash
# 检查DNS解析
nslookup your-domain.com

# 手动获取证书
sudo certbot certonly --webroot -w /var/www/certbot -d your-domain.com
```

**5. 数据库连接失败**
```bash
sudo docker exec morhon-odoo-db pg_isready -U odoo
cd /opt/morhon-odoo && sudo docker-compose restart db
```

## 性能和安全优化

### 自动性能优化

脚本会根据服务器配置自动进行以下优化：

#### Odoo应用层优化
- **Worker进程**: 根据CPU核心数自动计算 (推荐CPU核心数×2)
- **内存限制**: 智能分配内存限制，避免OOM
- **数据库连接池**: 自动配置连接数 (workers×2+4)
- **缓存配置**: 启用会话缓存，优化响应速度
- **日志优化**: 合理的日志级别和轮转策略

#### Nginx反向代理优化
- **Worker进程**: 自动设置为CPU核心数
- **连接数**: 根据系统资源动态调整 (CPU×1024)
- **缓冲区**: 优化代理缓冲区大小，提升传输效率
- **Gzip压缩**: 启用智能压缩，减少带宽使用
- **静态文件缓存**: 7天缓存期，减少服务器负载
- **连接限制**: 防止DDoS攻击，限制单IP连接数

#### 系统内核优化
- **网络参数**: 优化TCP连接数和超时时间
- **内存管理**: 调整swap使用策略和脏页回写
- **文件系统**: 增加文件描述符限制和监控数量
- **日志轮转**: 自动清理旧日志，防止磁盘满

### 安全加固措施

#### 网络安全
- **防火墙**: 自动配置UFW，仅开放必要端口
- **SSL/TLS**: 强制HTTPS，使用TLS 1.2+加密
- **安全头部**: 完整的HTTP安全头部配置
- **连接限制**: 防止暴力破解和DDoS攻击

#### 应用安全
- **数据库隔离**: 禁用数据库管理界面访问
- **敏感路径保护**: 阻止访问配置文件和备份
- **文件上传限制**: 限制上传文件类型和大小
- **会话安全**: 安全的会话超时和管理

#### 系统安全
- **最小权限**: 容器和服务使用最小权限运行
- **数据卷隔离**: Docker卷映射，防止直接文件访问
- **日志审计**: 完整的访问和错误日志记录
- **自动更新**: SSL证书自动续期

### 性能监控指标

脚本提供的系统状态检查包括：

- **容器健康**: Docker容器运行状态和资源使用
- **服务状态**: Nginx、数据库服务运行情况
- **端口监听**: 关键端口的监听状态
- **磁盘空间**: 存储空间使用情况和预警
- **内存使用**: 系统和应用内存占用
- **SSL证书**: 证书有效期和自动续期状态

### 性能调优建议

#### 根据用户数量调优

**小型团队 (1-10人)**:
```bash
# Odoo配置调整
workers = 2
limit_memory_hard = 512M
limit_memory_soft = 384M
```

**中型企业 (10-50人)**:
```bash
# Odoo配置调整
workers = 4
limit_memory_hard = 1024M
limit_memory_soft = 768M
```

**大型企业 (50-200人)**:
```bash
# Odoo配置调整
workers = 8
limit_memory_hard = 2048M
limit_memory_soft = 1536M
```

#### 数据库优化
```bash
# 进入数据库容器进行优化
sudo docker exec -it morhon-odoo-db psql -U odoo postgres

# 数据库维护命令
VACUUM ANALYZE;  # 清理和分析
REINDEX DATABASE postgres;  # 重建索引
```

#### 监控和告警
```bash
# 查看资源使用情况
sudo docker stats morhon-odoo morhon-odoo-db

# 查看Nginx状态
sudo nginx -t && sudo systemctl status nginx

# 查看系统负载
htop  # 或 top
```

## 系统模块说明

### ⚠️ 重要说明

**茂亨Odoo基于原生Odoo模块进行优化**，包含外贸企业运营所需的完整模块：

#### 📦 **内置核心模块**
- ✅ **销售管理** - 客户关系、报价管理、订单处理
- ✅ **采购管理** - 供应商管理、采购订单、收货验收
- ✅ **库存管理** - 多仓库管理、库存调拨、盘点管理
- ✅ **财务管理** - 应收应付、成本核算、财务报表
- ✅ **项目管理** - 项目跟踪、任务管理、时间记录
- ✅ **制造管理** - 生产计划、工艺路线、质量控制（如需要）
- ✅ **人力资源** - 员工管理、考勤管理、薪资管理

#### 🌟 **外贸业务优化**
- ✅ **多币种支持** - 汇率管理、外币结算、汇兑损益
- ✅ **多语言界面** - 中英文切换，国际化支持
- ✅ **单证优化** - 发票、装箱单等外贸单证格式优化
- ✅ **报表优化** - 符合外贸企业需求的报表格式
- ✅ **流程优化** - 针对外贸业务流程的细节改进

#### 🚫 **严禁自装插件**

**请勿自行安装第三方插件！**

**风险说明**：
- 未经测试的插件可能导致系统不稳定
- 插件冲突可能造成数据丢失
- 安全漏洞可能暴露系统风险
- 影响外贸业务的正常运行

**数据保护机制**：
- 所有数据存储在Docker卷中
- 防止用户直接访问和修改文件
- 避免插件安装导致的文件冲突

**免责声明**：如果用户违反建议，自行安装第三方模块导致任何问题，**茂亨科技概不承担任何责任**。

**正确的开发方式**：联系茂亨科技技术团队进行专业功能开发。

## 网站功能说明

### ⚠️ 重要提醒：网站功能使用建议

茂亨Odoo系统包含完整的网站功能模块，但使用建议取决于您的业务场景：

#### 🚫 **通常不推荐使用网站功能**

**全球化业务场景下的问题**：

1. **服务器位置冲突问题**：
   - **企业管理系统**：需要部署在靠近员工的位置（企业内网或就近机房）
   - **企业网站**：需要部署在靠近客户的位置（全球CDN节点）
   - **无法兼顾**：一台服务器无法同时满足员工和客户的最佳访问速度

2. **功能专业性差异**：
   - **Odoo网站功能**：基础功能，主要用于展示
   - **专业网站系统**：WordPress、Drupal等功能更丰富
   - **生态差异**：缺乏丰富的主题、插件、SEO工具

#### ✅ **推荐使用网站功能的场景**

**当客户和员工在同一地理区域时**，使用Odoo网站功能具有明显优势：

**🇨🇳 中国国内企业（强烈推荐）**：
- ✅ **统一部署**：服务器部署在国内，员工和客户访问速度都很快
- ✅ **网络环境**：避免跨境网络问题，稳定性更好
- ✅ **WordPress限制**：由于网络环境限制，WordPress插件和主题更新困难
- ✅ **一体化管理**：客户数据、订单、网站内容统一管理
- ✅ **本土化优势**：更适合国内的支付、物流、营销环境

**其他适用场景**：
- ✅ **区域性企业**：业务范围限定在特定国家或地区
- ✅ **本地服务商**：主要服务本地客户的企业
- ✅ **B2B企业**：客户群体相对固定且集中

#### 📊 **场景对比分析**

| 业务场景 | 推荐方案 | 原因 |
|---------|----------|------|
| 🌍 全球化外贸 | 分离部署 | 服务器位置冲突，需要CDN |
| 🇨🇳 中国国内业务 | Odoo网站功能 | 统一部署，避免WordPress限制 |
| 🏢 B2B企业 | Odoo网站功能 | 客户群体集中，一体化管理 |
| 🛒 跨境电商 | 分离部署 | 需要全球CDN优化 |
| 🏪 本地零售 | Odoo网站功能 | 客户和员工都在本地 |

#### 💡 **具体建议**

**中国国内企业**：
```bash
# 推荐配置
部署位置：国内云服务器（阿里云、腾讯云等）
访问域名：company.com 或 www.company.com
网站功能：启用Odoo网站模块
优势：一体化管理，避免WordPress网络问题
```

**全球化企业**：
```bash
# 推荐配置
企业管理：erp.company.com（就近部署）
企业网站：company.com（全球CDN）
分离部署：各自优化访问速度
```

### 🔧 **中国国内企业网站功能优化**

如果您是中国国内企业，客户和员工都在国内，可以考虑启用Odoo网站功能：

#### 1. 启用网站模块
```bash
# 访问Odoo管理界面
https://company.com  # 或 http://server-ip

# 进入应用商店
设置 → 应用 → 搜索相关模块

# 推荐启用的网站模块
- Website Builder (网站构建器) - 基础必需
- Website Sale (电商网站) - 如需在线销售
- Website Blog (博客) - 内容营销
- Website Forum (论坛) - 客户社区
```

#### 2. 中国国内网站优化配置

**针对国内网络环境的Nginx优化**：
```nginx
# 编辑Nginx配置文件
sudo nano /etc/nginx/sites-available/morhon-odoo

# 国内网站优化配置
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    expires 30d;  # 国内网络稳定，可以设置更长缓存
    add_header Cache-Control "public, immutable";
    add_header Vary Accept-Encoding;
    access_log off;
}

# 针对国内CDN的配置
location ~* /web/static/ {
    expires 7d;
    add_header Cache-Control "public";
    # 可以配置阿里云CDN或腾讯云CDN
}

# 重启Nginx应用配置
sudo systemctl reload nginx
```

**针对国内环境的Odoo配置**：
```bash
# 编辑Odoo配置文件
sudo nano /opt/morhon-odoo/config/odoo.conf

# 添加国内网站优化参数
[options]
# 网站性能优化（国内环境）
max_cron_threads = 4  # 国内服务器性能通常较好
limit_time_real_cron = 600
osv_memory_count_limit = 0

# 网站缓存优化（利用Redis）
enable_redis = True
session_redis = True

# 文件上传优化（国内网络稳定）
max_file_upload_size = 268435456  # 256MB，适合国内大文件上传

# 国内支付和物流集成
# 可以集成支付宝、微信支付等

# 重启Odoo应用配置
cd /opt/morhon-odoo && sudo docker-compose restart odoo
```

#### 3. 国内SEO和营销优化

**国内搜索引擎优化**：
```bash
# 在Odoo网站设置中配置
网站 → 配置 → 设置

# 国内SEO优化重点
✓ 百度搜索引擎优化
✓ 配置百度站长工具
✓ 设置中文关键词
✓ 启用百度统计
✓ 配置微信分享优化
```

**国内社交媒体集成**：
```nginx
# Nginx配置支持国内社交分享
location / {
    # 微信分享优化
    add_header X-Frame-Options "ALLOWALL" always;
    
    # 百度SEO友好
    add_header X-Robots-Tag "index, follow" always;
}
```

#### 4. 国内网站功能的优势

**一体化管理优势**：
- ✅ **客户数据统一**：网站访客直接转化为CRM客户
- ✅ **订单流程整合**：网站订单直接进入ERP系统
- ✅ **库存实时同步**：网站商品库存与ERP库存实时同步
- ✅ **财务自动化**：网站收款自动生成财务记录

**国内环境优势**：
- ✅ **网络稳定**：避免跨境网络问题
- ✅ **访问速度**：国内服务器访问速度快
- ✅ **支付集成**：更容易集成国内支付方式
- ✅ **合规性**：符合国内网络和数据安全要求

### 🚫 **全球化企业仍不推荐**

如果您的业务是全球化的，仍然建议分离部署：

**原因**：
- ❌ 国外客户访问国内服务器速度慢
- ❌ 跨境网络不稳定
- ❌ 无法利用全球CDN优势
- ❌ 不同地区的合规要求不同

**推荐方案**：
```bash
# 全球化企业推荐配置
企业管理：erp.company.com（国内部署，员工使用）
企业网站：company.com（全球CDN，客户访问）
```

## 版本历史

### v6.2 (2026-01-10) - 当前版本

**新增功能**：
- ✨ 简化部署模式选择（输入域名即域名模式）
- ✨ 增强的跨服务器迁移功能
- ✨ 系统状态检查和监控
- ✨ **Ubuntu专用优化**: 仅支持Ubuntu系统，确保最佳兼容性
- ✨ 容器健康检查配置
- ✨ **全面性能优化**: 自动调优CPU、内存、网络参数
- ✨ **系统安全加固**: 内核参数优化、日志轮转、文件描述符限制

**改进优化**：
- 🔧 更新卷名规范（morhon-pg、morhon-odoo）
- 🔧 **Nginx高性能配置**: 连接限制、缓存优化、Gzip压缩
- 🔧 **Odoo性能调优**: 智能Worker配置、数据库连接池优化
- 🔧 增强错误处理和日志记录
- � 自o动性能参数调优

**安全增强**：
- 🔒 Docker卷映射防止插件冲突
- 🔒 **完整安全头部**: CSP、HSTS、XSS保护等
- 🔒 **敏感路径保护**: 禁止访问数据库管理、配置文件
- � **连接限制**: 和防DDoS攻击，单IP连接数限制
- � SS函L证书自动获取和续期

**修复问题**：
- 🐛 兼容性处理：自动检测和迁移旧卷名数据
- 🐛 修复函数结构和语法错误
- 🐛 改进备份恢复流程

### 📞 **技术支持范围说明**

#### ✅ **提供技术支持的范围**

**企业管理功能**：
- ✅ 茂亨科技提供完整技术支持
- ✅ 包含部署、配置、性能优化
- ✅ 涵盖备份恢复、安全加固

**中国国内企业网站功能**：
- ✅ 提供基础的网站功能启用指导
- ✅ 提供国内环境优化建议
- ✅ 协助解决网站与ERP集成问题

#### ❌ **不提供技术支持的范围**

**全球化网站功能**：
- ❌ 全球CDN配置和优化
- ❌ 跨境网络问题解决
- ❌ 多语言网站复杂配置

**高级网站功能**：
- ❌ 复杂的网站主题定制
- ❌ 高级SEO和营销配置
- ❌ 第三方网站插件集成

#### 💡 **建议方案**

**中国国内企业**：
- 可以使用Odoo网站功能，我们提供基础支持
- 复杂网站需求建议找专业网站开发商

**全球化企业**：
- 企业管理用茂亨Odoo，我们提供完整支持
- 网站建设建议使用WordPress等专业系统

## 技术支持

### 开源社区
- **GitHub**: https://github.com/morhon-tech/morhon-odoo
- **Issues**: 问题反馈和功能建议
- **Discussions**: 社区讨论

### 商业支持
- **技术咨询**: 部署和配置支持
- **功能开发**: 企业级功能开发
- **培训服务**: 使用培训和最佳实践
- **运维支持**: 7x24小时技术支持

### 联系方式
- **官网**: https://www.morhon.com
- **邮箱**: support@morhon.com

## 许可证

MIT License - 详见 LICENSE 文件

---

**茂亨科技** - 专注外贸企业管理系统解决方案  
**版本**: v6.2  
**更新时间**: 2026-01-10
